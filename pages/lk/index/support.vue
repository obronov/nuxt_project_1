<template>
  <div>
    <div class="support" v-if="!emptySupport">
      <h1 class="lk-title lk-title_support">{{support.title}}</h1>
      <ul class="tabs-support">
        <li class="tabs-support__item" v-for="(item, tabIndex) in support.support_services" :key="tabIndex">
          <button class="tabs-support__btn" type="button" :class="{active: activeTab == item.type}" @click="selectedTab = item.type">
            <svg v-if="item.type == 'chat'" width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M43.75 3.125C44.5788 3.125 45.3737 3.45424 45.9597 4.04029C46.5458 4.62634 46.875 5.4212 46.875 6.25V31.25C46.875 32.0788 46.5458 32.8737 45.9597 33.4597C45.3737 34.0458 44.5788 34.375 43.75 34.375H35.9375C34.9672 34.375 34.0103 34.6009 33.1424 35.0348C32.2746 35.4688 31.5197 36.0988 30.9375 36.875L25 44.7906L19.0625 36.875C18.4803 36.0988 17.7254 35.4688 16.8576 35.0348C15.9897 34.6009 15.0328 34.375 14.0625 34.375H6.25C5.4212 34.375 4.62634 34.0458 4.04029 33.4597C3.45424 32.8737 3.125 32.0788 3.125 31.25V6.25C3.125 5.4212 3.45424 4.62634 4.04029 4.04029C4.62634 3.45424 5.4212 3.125 6.25 3.125H43.75ZM6.25 0C4.5924 0 3.00269 0.65848 1.83058 1.83058C0.65848 3.00269 0 4.5924 0 6.25L0 31.25C0 32.9076 0.65848 34.4973 1.83058 35.6694C3.00269 36.8415 4.5924 37.5 6.25 37.5H14.0625C14.5476 37.5 15.0261 37.613 15.46 37.8299C15.894 38.0469 16.2714 38.3619 16.5625 38.75L22.5 46.6656C22.7911 47.0537 23.1685 47.3687 23.6025 47.5857C24.0364 47.8027 24.5149 47.9156 25 47.9156C25.4851 47.9156 25.9636 47.8027 26.3975 47.5857C26.8315 47.3687 27.2089 47.0537 27.5 46.6656L33.4375 38.75C33.7286 38.3619 34.106 38.0469 34.54 37.8299C34.9739 37.613 35.4524 37.5 35.9375 37.5H43.75C45.4076 37.5 46.9973 36.8415 48.1694 35.6694C49.3415 34.4973 50 32.9076 50 31.25V6.25C50 4.5924 49.3415 3.00269 48.1694 1.83058C46.9973 0.65848 45.4076 0 43.75 0L6.25 0Z" fill="#E77C5A"/>
              <path d="M9.375 10.9375C9.375 10.5231 9.53962 10.1257 9.83265 9.83265C10.1257 9.53962 10.5231 9.375 10.9375 9.375H39.0625C39.4769 9.375 39.8743 9.53962 40.1674 9.83265C40.4604 10.1257 40.625 10.5231 40.625 10.9375C40.625 11.3519 40.4604 11.7493 40.1674 12.0424C39.8743 12.3354 39.4769 12.5 39.0625 12.5H10.9375C10.5231 12.5 10.1257 12.3354 9.83265 12.0424C9.53962 11.7493 9.375 11.3519 9.375 10.9375ZM9.375 18.75C9.375 18.3356 9.53962 17.9382 9.83265 17.6451C10.1257 17.3521 10.5231 17.1875 10.9375 17.1875H39.0625C39.4769 17.1875 39.8743 17.3521 40.1674 17.6451C40.4604 17.9382 40.625 18.3356 40.625 18.75C40.625 19.1644 40.4604 19.5618 40.1674 19.8549C39.8743 20.1479 39.4769 20.3125 39.0625 20.3125H10.9375C10.5231 20.3125 10.1257 20.1479 9.83265 19.8549C9.53962 19.5618 9.375 19.1644 9.375 18.75ZM9.375 26.5625C9.375 26.1481 9.53962 25.7507 9.83265 25.4576C10.1257 25.1646 10.5231 25 10.9375 25H26.5625C26.9769 25 27.3743 25.1646 27.6674 25.4576C27.9604 25.7507 28.125 26.1481 28.125 26.5625C28.125 26.9769 27.9604 27.3743 27.6674 27.6674C27.3743 27.9604 26.9769 28.125 26.5625 28.125H10.9375C10.5231 28.125 10.1257 27.9604 9.83265 27.6674C9.53962 27.3743 9.375 26.9769 9.375 26.5625Z" fill="#E77C5A"/>
            </svg>
            <svg v-if="item.type == 'request'" width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M42.9656 1.59917L43.4399 1.12488C43.7969 0.7681 44.2206 0.485129 44.687 0.292122C45.1533 0.0991156 45.6531 -0.000147627 46.1578 1.6479e-07C46.6625 0.000147956 47.1623 0.0997039 47.6285 0.292984C48.0947 0.486264 48.5183 0.769482 48.8751 1.12647C49.2319 1.48346 49.5149 1.90722 49.7079 2.37357C49.9009 2.83991 50.0001 3.33971 50 3.84441C49.9999 4.34912 49.9003 4.84886 49.707 5.31509C49.5137 5.78132 49.2305 6.20492 48.8735 6.5617L48.3992 7.03281C49.2106 7.94275 49.6431 9.12857 49.6082 10.3472C49.5733 11.5658 49.0735 12.7249 48.2114 13.5869L15.4504 46.3511C15.2456 46.5548 14.9892 46.699 14.7088 46.7681L1.97615 49.9512C1.7097 50.0176 1.43061 50.0139 1.16602 49.9405C0.901424 49.867 0.660327 49.7264 0.466162 49.5322C0.271997 49.3381 0.131369 49.097 0.0579484 48.8324C-0.0154723 48.5678 -0.0191883 48.2887 0.0471617 48.0223L3.23031 35.2896C3.29996 35.0103 3.44407 34.7551 3.64731 34.5512L34.3393 3.85921C34.0323 3.64316 33.6589 3.54257 33.2849 3.57518C32.911 3.6078 32.5606 3.77154 32.2957 4.03746L21.8167 14.5196C21.6688 14.6676 21.4931 14.7849 21.2997 14.865C21.1064 14.9451 20.8992 14.9863 20.6899 14.9863C20.4806 14.9863 20.2734 14.9451 20.0801 14.865C19.8867 14.7849 19.711 14.6676 19.5631 14.5196C19.4151 14.3716 19.2977 14.1959 19.2176 14.0026C19.1375 13.8092 19.0963 13.602 19.0963 13.3927C19.0963 13.1835 19.1375 12.9762 19.2176 12.7829C19.2977 12.5896 19.4151 12.4139 19.5631 12.2659L30.0484 1.78697C30.9109 0.924388 32.0709 0.424651 33.2903 0.390319C34.5097 0.355987 35.6959 0.789664 36.6057 1.60235C37.4803 0.820692 38.612 0.388335 39.785 0.387747C40.958 0.38716 42.0902 0.818385 42.9656 1.59917ZM40.9156 4.03746C40.6172 3.73909 40.2124 3.57147 39.7904 3.57147C39.3684 3.57147 38.9636 3.73909 38.6652 4.03746L6.20656 36.4897L3.77463 46.2206L13.5055 43.7887L45.9641 11.3364C46.1123 11.1886 46.2299 11.013 46.3102 10.8196C46.3904 10.6262 46.4317 10.4189 46.4317 10.2096C46.4317 10.0002 46.3904 9.79296 46.3102 9.59959C46.2299 9.40623 46.1123 9.2306 45.9641 9.08276L40.9188 4.03746H40.9156Z" fill="#E77C5A"/>
            </svg>
            <span>{{item.name}}</span>
          </button>
        </li>
      </ul>
      <div class="support__list"  v-for="(item, index) in support.support_services" :key="index">
        <div class="support__chat" :class="{active: activeTab == item.type}"  v-html="item.script"></div>
      </div>
    </div>
  </div>
</template>

<script>
import global from "~/mixins/global";
export default {
  mixins: [global],
  data(){
    return{
      support: {},
      selectedTab: undefined
    }
  },
  head(){
    try {
      return{
        title: `Чат техподдержки`,
        meta: [
          { hid: 'description', name: 'description', content: `` },
          { hid: 'keywords', name: 'keywords', content: `` },
          { hid: 'og:title', property: 'og:title', content: `` },
          { hid: 'og:description', property: 'og:description', content: `` },
          { hid: 'og:image', property: 'og:image', content: `` },
          { hid: 'og:type', property: 'og:type', content: 'website' },
          { hid: 'og:url', property: 'og:url', content: process.env.clientUrl + this.$route.path }
        ]
      }
    } catch (error) {
    }
  },
  async fetch() {
    try {
      this.support = await this.fetchLkAuth(process.env.baseUrl + 'lk_support');
      /*  this.support = await fetch(process.env.fakeUrl + 'lk_support')
      .then(res => res.json()) */
    } catch (error) {
      console.error(`Страница ${this.$route.fullPath}: `,  error)
    }
  },
  computed:{
    activeTab(){
      if(this.selectedTab){
        return this.selectedTab;
      }else{
        return this.support.support_services[0].type;
      }
    },
    emptySupport(){
      for (let key in this.support) {
        return false;
      }
      return true;
    }
  },
  watch: {
    $route() {
      this.$refs.scroll.$el.scrollTop = 0;
    }
  }
}

</script>

<style lang='scss' scoped>

</style>